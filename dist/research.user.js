// ==UserScript==
// @name        Super Bay - Research
// @description Better controls in seller hub research
// @namespace   https://github.com/geotrev/super-bay
// @version     1.0.14
// @author      George Treviranus
// @run-at      document-idle
// @match       https://www.ebay.com/sh/research*
// @downloadURL https://github.com/geotrev/super-bay/raw/main/dist/research.user.js
// @updateURL   https://github.com/geotrev/super-bay/raw/main/dist/research.user.js
// @grant       none
// ==/UserScript==
!function(){"use strict";const e=new class{constructor(){const e=document.createElement("div"),t=document.createElement("div");e.innerHTML='<div style="position: fixed;top: 0px;right: 0px;bottom: unset;left: 0px;z-index: 4000;padding: 48px 16px;pointer-events: none;display: flex;flex-direction: column;align-items: flex-end;"></div>',t.innerHTML='<section role="region" style="pointer-events: auto;flex-wrap: wrap;background-color: #333;margin: 0px;color: #dedede;padding: 12px 16px;border-radius: 8px;max-width: 280px;box-shadow: 0 5px 10px rgba(0,0,0,0.5);margin-bottom: 12px;"><h3 style="margin-bottom: 8px;margin-top:0;padding: 0;font-weight: bold;font-size: 12px;">[Super Bay]</h3><p style="font-size: 16px;line-height: 22px;padding: 0;margin:0;" data-notify-content></p></section>',this.notifyWrapper=e.firstElementChild,this.notifyEl=t.firstElementChild,document.body.appendChild(this.notifyWrapper),this.destroy=this.destroy.bind(this)}trigger({content:e}){const t=this.notifyEl.cloneNode(!0);t.querySelector("p").innerText=e,this.notifyWrapper.appendChild(t),setTimeout(this.destroy,2e3)}destroy(){this.notifyWrapper.removeChild(this.notifyWrapper.firstElementChild)}};async function t(t,n,o=50){let r=-1,i=null;for(;++r<o;)if(await new Promise((e=>setTimeout((()=>{i=t(),e()}),250))),i)return i;n&&e.trigger({content:n})}const n=new Map,o={attributes:!0,subtree:!0,childList:!0};function r(e,t){n.get(e.selector)||(n.set(e.selector,e),e.elements.forEach((n=>{n.dataset.superBaySel=e.selector,t.observe(n,o),n.addEventListener(e.type,e.handler)})))}async function i(e,o){let i=[];for(const t of e){const{target:e,removedNodes:r}=t;if(-1===Array.from(r).indexOf(e))continue;const s=n.get(e.dataset.superBaySel);s&&(s.elements.forEach((e=>e.removeEventListener(s.type,s.handler))),s.elements.forEach((e=>o.unobserve(e))),s.elements=[],n.delete(s.selector),i.push(s))}if(i.length)for(const e of i){const n=await t((()=>{const t=Array.from(document.querySelectorAll(e.selector));return t.length?t:null}));n&&(e.elements=n,r(e,o))}}const s=".sold-result-table",c=".research-container input",l=".research-table-row",a=".research-table-row__link-row-anchor",d=[".search-input-panel__research-button",".search-input-panel__dropdown",".tabs__items"],u=[".filter-menu-button__footer"],p="#EFEFEF",{subscribeEventTargets:f}=function(){const e=new MutationObserver(i);return{subscribeEventTargets:function(t={}){r(t,e)},unsubscribeEventTargets:function(){}}}();async function h(){await t((()=>document.querySelector(s)),"Results table took too long to load. Try again.")&&function(){e.trigger({content:"Table upgraded. Removed listings have a darker background color."});const t=document.querySelector(s).querySelectorAll(l);for(const e of t)e.querySelector(a)||(e.style.backgroundColor=p)}()}function y(e){e.target.disabled||h()}function m(e){"Enter"===e.key&&h()}!async function(){e.trigger({content:"Plugin activated!"}),document.querySelector(c).addEventListener("keydown",m);for(const e of d){const n=await t((()=>document.querySelector(e)));n&&f({elements:[n],selector:e,type:"click",handler:y})}for(const e of u){const n=await t((()=>{const t=Array.from(document.querySelectorAll(e));return t.length?t:null}));n&&f({elements:n,selector:e,type:"click",handler:y})}h()}()}();
