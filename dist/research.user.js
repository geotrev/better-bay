// ==UserScript==
// @name        Better Bay - Research
// @description Better controls in seller hub research
// @namespace   https://github.com/geotrev/better-bay
// @author      George Treviranus
// @run-at      document-idle
// @match       https://www.ebay.com/sh/research*
// @version     2.0.0
// @downloadURL https://github.com/geotrev/better-bay/raw/main/dist/research.user.js
// @updateURL   https://github.com/geotrev/better-bay/raw/main/dist/research.user.js
// @grant       none
// ==/UserScript==
!function(){"use strict";const e=new function(){const e=document.createElement("div"),t=document.createElement("div");e.innerHTML='<div style="position: fixed;top: 0px;right: 0px;bottom: unset;left: 0px;z-index: 4000;padding: 48px 16px;pointer-events: none;display: flex;flex-direction: column;align-items: flex-end;"></div>',t.innerHTML='<section role="region" style="pointer-events: auto;flex-wrap: wrap;background-color: #333;margin: 0px;color: #dedede;padding: 12px 16px;border-radius: 8px;max-width: 280px;box-shadow: 0 5px 10px rgba(0,0,0,0.5);margin-bottom: 12px;"><h3 style="margin-bottom: 8px;margin-top:0;padding: 0;font-weight: bold;font-size: 12px;">[Better Bay]</h3><p style="font-size: 16px;line-height: 22px;padding: 0;margin:0;" data-notify-content></p></section>';const n=e.firstElementChild,o=t.firstElementChild;let r=0;function i(){return r<=0}function c(){i()||(n.removeChild(n.firstElementChild),r-=1)}return document.body.appendChild(n),document.addEventListener("keydown",(function(e){i()||"Escape"!==e.key||(e.preventDefault(),c())}),!0),function({content:e,delay:t=2e3}){const i=o.cloneNode(!0);i.querySelector("p").innerText=e,n.appendChild(i),r+=1,setTimeout(c,t)}};async function t(t,n,o={}){const r=o.tries||50,i=o.interval||100,c="Unable to resolve value after,"+String(r*i)+"ms.";return new Promise(((o,l)=>{let a;const s=setInterval((()=>{const i=t();i&&(clearInterval(s),o(i)),++a===r&&(clearInterval(s),n&&e({content:n||c}),l())}),i)}))}const n={SOLD_RESULT_TABLE:".sold-result-table",SEARCH_INPUT:".research-container input",SEARCH_DROPDOWN:".search-input-panel__dropdown",SEARCH_SUBMIT_BTN:".search-input-panel__research-button",TABLE_ROW:".research-table-row",TABLE_ROW_ANCHOR:".research-table-row__link-row-anchor"},o=[".tabs__items",".category-selection-panel .filter-menu-button__items",".category-selection-panel .filter-menu-button__footer"],r=[".filters-panel .filter-menu-button__footer",".search-filter-pills .filter-pill__close"],i={NO_ANCHOR_BG_COLOR:"#EFEFEF"},c={PLUGIN_ACTIVATED:"Plugin activated!",TABLE_UPGRADED:"Table upgraded. Removed listings have a darker background color.",TABLE_UPGRADE_FAILED:"Results table took too long to load. Try again."};let l=[];async function a(){await t((()=>document.querySelector(n.SOLD_RESULT_TABLE)),c.TABLE_UPGRADE_FAILED)&&function(){e({content:c.TABLE_UPGRADED});const t=document.querySelector(n.SOLD_RESULT_TABLE).querySelectorAll(n.TABLE_ROW);for(const e of t)e.querySelector(n.TABLE_ROW_ANCHOR)||(e.style.backgroundColor=i.NO_ANCHOR_BG_COLOR)}()}function s(e){e.target.disabled||setTimeout(u,2e3)}function d(e){"Enter"===e.key&&setTimeout(u,2e3)}async function u(){await a(),l.forEach((e=>e.removeEventListener("click",s))),l=[],p()}async function p(){for(const e of o){const n=await t((()=>document.querySelector(e)));n&&(n.addEventListener("click",s),l.push(n))}for(const e of r){const n=await t((()=>{const t=Array.from(document.querySelectorAll(e));return t.length?t:null}));n&&(n.forEach((e=>e.addEventListener("click",s))),l.push(...n))}}!async function(){e({content:c.PLUGIN_ACTIVATED});const t=document.querySelector(n.SEARCH_SUBMIT_BTN),o=document.querySelector(n.SEARCH_DROPDOWN),r=document.querySelector(n.SEARCH_INPUT);t.addEventListener("click",s),o.addEventListener("click",s),r.addEventListener("keydown",d),await a(),await p()}()}();
