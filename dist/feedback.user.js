// ==UserScript==
// @name        Better Bay - Feedback
// @description Automate feedback on ebay
// @namespace   https://github.com/geotrev/better-bay
// @author      George Treviranus
// @run-at      document-idle
// @match       https://www.ebay.com/fdbk/leave_feedback*
// @version     1.0.15
// @downloadURL https://github.com/geotrev/better-bay/raw/main/dist/feedback.user.js
// @updateURL   https://github.com/geotrev/better-bay/raw/main/dist/feedback.user.js
// @grant       none
// ==/UserScript==
!function(){"use strict";const e=new function(){const e=document.createElement("div"),t=document.createElement("div");e.innerHTML='<div style="position: fixed;top: 0px;right: 0px;bottom: unset;left: 0px;z-index: 4000;padding: 48px 16px;pointer-events: none;display: flex;flex-direction: column;align-items: flex-end;"></div>',t.innerHTML='<section role="region" style="pointer-events: auto;flex-wrap: wrap;background-color: #333;margin: 0px;color: #dedede;padding: 12px 16px;border-radius: 8px;max-width: 280px;box-shadow: 0 5px 10px rgba(0,0,0,0.5);margin-bottom: 12px;"><h3 style="margin-bottom: 8px;margin-top:0;padding: 0;font-weight: bold;font-size: 12px;">[Super Bay]</h3><p style="font-size: 16px;line-height: 22px;padding: 0;margin:0;" data-notify-content></p></section>';const n=e.firstElementChild,o=t.firstElementChild;let i=0;function c(){return i<=0}function l(){c()||(n.removeChild(n.firstElementChild),i-=1)}return document.body.appendChild(n),document.addEventListener("keydown",(function(e){c()||"Escape"!==e.key||(e.preventDefault(),l())}),!0),function({content:e,delay:t=2e3}){const c=o.cloneNode(!0);c.querySelector("p").innerText=e,n.appendChild(c),i+=1,setTimeout(l,t)}},t={DEBUG:!1,SALE_FEEDBACK_TEXT:"Great buyer + fast payment. Thanks.",PURCHASE_FEEDBACK_TEXT:"Easy purchase + item arrived as described. Thanks."},n=".single-feedback-template",o='input[value="2"][name^="ON_TIME_DELIVERY"]',i='input[value="POSITIVE"][name^="OVERALL_EXPERIENCE"]',c='input[value="5"][name^="DSR_ITEM_AS_DESCRIBED"]',l='input[value="5"][name^="DSR_SHIPPING_CHARGES"]',r='input[value="5"][name^="DSR_SHIPPING_TIME"]',a='input[value="5"][name^="DSR_COMMUNICATION"]',d='textarea[name="OVERALL_EXPERIENCE_COMMENT"]',u='input[name="OVERALL_EXPERIENCE_COMMENT"]',s='button[id^="submitFeedbackBtn-"]',E="No feedback, exiting.",p="Filling feedback...";let f=!1;function m(e,t){return t>1?e+"s":e}function y(y){if(!window.location.pathname.startsWith("/fdbk/leave_feedback")||f||!["f","F"].includes(y.key)||!y.altKey||!y.shiftKey)return;y.ctrlKey&&(t.DEBUG=!0),f=!0;let x=0,b=0;const S=document.querySelectorAll(n),h=S.length;if(0===h)return f=!1,e({content:E});function k(e){e.dispatchEvent(new Event("blur"))}e({content:p});for(let e=0;e<h;e++){const n=S[e];if(n.textContent.indexOf("Sold By")>-1){const e=n.querySelector(o);e&&e.click();const u=n.querySelector(i);u&&u.click();const s=n.querySelector(c);s&&s.click();const E=n.querySelector(l);E&&E.click();const p=n.querySelector(r);p&&p.click();const f=n.querySelector(a);f&&f.click();const m=n.querySelector(d);m&&(m.value=t.PURCHASE_FEEDBACK_TEXT,k(m)),x+=1}else if(n.textContent.indexOf("Purchased by")>-1){const e=n.querySelector(i);e&&e.click();const o=n.querySelector(u);o&&(o.value=t.SALE_FEEDBACK_TEXT,k(o)),b+=1}}if(!t.DEBUG){const e=document.querySelectorAll(s);e.length&&e.forEach((e=>!e.disabled&&e.click()))}x>0&&e({content:`Feedback completed for ${x} ${m("seller",x)}.`}),b>0&&e({content:`Feedback completed for ${b} ${m("buyer",b)}.`}),f=!1,t.DEBUG=!1}e({content:"Plugin activated! Press Alt+Shift+F to fill and submit all feedback, or Ctrl+Alt+Shift+F to fill (but not submit) feedback."}),document.addEventListener("keydown",y)}();
