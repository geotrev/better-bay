// ==UserScript==
// @name        Better Bay - Feedback
// @description Automate feedback on ebay
// @namespace   https://github.com/geotrev/better-bay
// @author      George Treviranus
// @run-at      document-idle
// @match       https://www.ebay.com/fdbk/leave_feedback*
// @version     2.0.0
// @downloadURL https://github.com/geotrev/better-bay/raw/main/dist/feedback.user.js
// @updateURL   https://github.com/geotrev/better-bay/raw/main/dist/feedback.user.js
// @grant       none
// ==/UserScript==
!function(){"use strict";const e=new function(){const e=document.createElement("div"),t=document.createElement("div");e.innerHTML='<div style="position: fixed;top: 0px;right: 0px;bottom: unset;left: 0px;z-index: 4000;padding: 48px 16px;pointer-events: none;display: flex;flex-direction: column;align-items: flex-end;"></div>',t.innerHTML='<section role="region" style="pointer-events: auto;flex-wrap: wrap;background-color: #333;margin: 0px;color: #dedede;padding: 12px 16px;border-radius: 8px;max-width: 280px;box-shadow: 0 5px 10px rgba(0,0,0,0.5);margin-bottom: 12px;"><h3 style="margin-bottom: 8px;margin-top:0;padding: 0;font-weight: bold;font-size: 12px;">[Better Bay]</h3><p style="font-size: 16px;line-height: 22px;padding: 0;margin:0;" data-notify-content></p></section>';const n=e.firstElementChild,i=t.firstElementChild;let E=0;function o(){return E<=0}function a(){o()||(n.removeChild(n.firstElementChild),E-=1)}return document.body.appendChild(n),document.addEventListener("keydown",(function(e){o()||"Escape"!==e.key||(e.preventDefault(),a())}),!0),function({content:e,delay:t=2e3}){const o=i.cloneNode(!0);o.querySelector("p").innerText=e,n.appendChild(o),E+=1,setTimeout(a,t)}},t={SUBMIT:!1,SALE_FEEDBACK_TEXT:"Great buyer + fast payment. Thanks.",PURCHASE_FEEDBACK_TEXT:"Easy purchase + item arrived as described. Thanks."},n={REVIEW_ITEMS:".single-feedback-template",ON_TIME_DEL:'input[value="2"][name^="ON_TIME_DELIVERY"]',OVERALL_EXP:'input[value="POSITIVE"][name^="OVERALL_EXPERIENCE"]',ITEM_AS_DESC:'input[value="5"][name^="DSR_ITEM_AS_DESCRIBED"]',SHIP_CHARGES:'input[value="5"][name^="DSR_SHIPPING_CHARGES"]',SHIP_TIME:'input[value="5"][name^="DSR_SHIPPING_TIME"]',SELLER_COMMS:'input[value="5"][name^="DSR_COMMUNICATION"]',EXP_COMMENT_TA:'textarea[name="OVERALL_EXPERIENCE_COMMENT"]',EXP_COMMENT_IN:'input[name="OVERALL_EXPERIENCE_COMMENT"]',SUBMIT_BTN:'button[id^="submitFeedbackBtn-"]'},i={NO_FEEDBACK:"No feedback, exiting.",FILLING_FEEDBACK:"Filling feedback...",HOW_TO:"Better Bay activated! Press Ctrl+Shift+F to fill all feedback OR Ctrl+Shift+Alt+F to fill & submit feedback."};let E=!1;function o(e,t){return t>1?e+"s":e}function a(e,t){const n=e.querySelector(t);n&&n.click()}function l(e,t,n){const i=e.querySelector(t);i&&(i.value=n,i.dispatchEvent(new Event("blur")))}function d(t,n){e({content:`Feedback completed for ${n} ${o(t,n)}.`})}function r(o){if(!window.location.pathname.startsWith("/fdbk/leave_feedback")||E||!["f","F"].includes(o.key)||!o.ctrlKey||!o.shiftKey)return;o.altKey&&(t.SUBMIT=!0),E=!0;let r=0,c=0;const u=document.querySelectorAll(n.REVIEW_ITEMS);if(0===u.length)return E=!1,e({content:i.NO_FEEDBACK});e({content:i.FILLING_FEEDBACK});for(const e of u)e.textContent.indexOf("Sold By")>-1?(a(e,n.ON_TIME_DEL),a(e,n.OVERALL_EXP),a(e,n.ITEM_AS_DESC),a(e,n.SHIP_CHARGES),a(e,n.SHIP_TIME),a(e,n.SELLER_COMMS),l(e,n.EXP_COMMENT_TA,t.PURCHASE_FEEDBACK_TEXT),r+=1):e.textContent.indexOf("Purchased by")>-1&&(a(e,n.OVERALL_EXP),l(e,n.EXP_COMMENT_IN,t.SALE_FEEDBACK_TEXT),c+=1);if(t.SUBMIT){const e=document.querySelectorAll(n.SUBMIT_BTN);e.length&&e.forEach((e=>!e.disabled&&e.click()))}r>0&&d("seller",r),c>0&&d("buyer",c),E=!1,t.SUBMIT=!1}e({content:i.HOW_TO}),document.addEventListener("keydown",r)}();
